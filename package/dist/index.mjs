var D=Object.defineProperty;var d=(l,t)=>D(l,"name",{value:t,configurable:!0});import{createRequire as P}from"node:module";const N=P(import.meta.url);class j{static{d(this,"HeadersParser")}headers=new Map;constructor(t){t&&this.add(t)}add(t){if(Array.isArray(t))for(const[e,s]of t)this.set(e,s);else if(typeof Headers<"u"&&t instanceof Headers)for(const[e,s]of t.entries())this.set(e,s);else if(typeof t=="object")for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&this.set(e,t[e]);return this}set(t,e){return this.headers.set(t.toLowerCase(),Array.isArray(e)?e:[e]),this}get(t){const e=this.headers.get(t.toLowerCase());return e?e[0]:void 0}getAll(t){return this.headers.get(t.toLowerCase())||[]}has(t){return this.headers.has(t.toLowerCase())}delete(t){return this.headers.delete(t.toLowerCase())}append(t,e){const s=t.toLowerCase();return this.headers.has(s)?this.headers.get(s).push(e):this.headers.set(s,[e]),this}entries(){return this.headers.entries()}keys(){return this.headers.keys()}values(){return this.headers.values()}forEach(t){for(const[e,s]of this.headers)t(s,e)}toObject(){const t={};for(const[e,s]of this.headers.entries())t[e]=s.length>1?s:s[0];return t}}Object.defineProperty(j,"name",{value:"Headers"});class x{static{d(this,"EnvironmentDetector")}static get getEnvironment(){return typeof Bun<"u"?"bun":typeof Deno<"u"?"deno":typeof process<"u"&&process.versions?.node?"node":"unknown"}static detectProtocol(t){try{return this.getEnvironment==="node"?t?.socket?.encrypted?"https":"http":"unknown"}catch{throw new Error("Failed to detect protocol.")}}static getHost(t){try{return t?.get("host")||"unknown"}catch{throw new Error("Failed to get host.")}}}async function O(l){const t=x.getEnvironment;if(t==="node")return new Promise((e,s)=>{let n="";l.on("data",r=>{n+=r.toString()}),l.on("end",()=>{try{e(JSON.parse(n))}catch{s(new Error("Invalid JSON format"))}})});if(t==="deno"||t==="bun")return await l.json();throw new Error("Unsupported environment for multipart parsing")}d(O,"parseJsonBody");async function k(l){const t=x.getEnvironment;if(t==="node")return new Promise((e,s)=>{let n="";l.on("data",r=>{n+=r.toString()}),l.on("end",()=>{try{e(n)}catch{s(new Error("Invalid JSON format"))}})});if(t==="deno"||t==="bun")return await l.text();throw new Error("Unsupported environment for multipart parsing")}d(k,"parseTextBody");async function L(l){const t=x.getEnvironment;if(t==="node")return new Promise((e,s)=>{let n="";l.on("data",r=>{n+=r.toString("binary")}),l.on("end",()=>{try{const r=n.split("&"),i={};r.forEach(o=>{const[a,c]=o.split("=");i[decodeURIComponent(a)]=decodeURIComponent(c||"")}),e(i)}catch{s(new Error("Invalid x-www-form-urlencoded format"))}})});if(t==="deno"||t==="bun"){const e=await l.formData(),s={};for(const[n,r]of e.entries())s[n]=r;return s}else throw new Error("Unsupported environment for multipart parsing")}d(L,"parseUrlEncodedBody");async function H(l,t,e){const s=x.getEnvironment;if(e?.sanitized,s==="node")return new Promise((n,r)=>{let i="";l.on("data",o=>{i+=o.toString("binary")}),l.on("end",()=>{try{const o={};i.split("----------------------------").forEach(h=>{const u=h.match(/name="(.*)"\r\n\r\n(.*)\r\n/);if(u&&u.length===3){const f=u[1],p=u[2];o[f]=p}});const c=i.split(`--${t}`);for(const h of c)if(h.includes("filename")){const u=h.match(/filename="([^"]+)"/),f=h.match(/name="([^"]+)"/),p=h.match(/Content-Type: ([^\r\n]+)/);if(u&&f&&p){let m=u[1];const y=f[1],g=p[1];e?.sanitized&&(m=`${Date.now()}-${m.replace(/\s+/g,"")?.replace(/[^a-zA-Z0-9.-]/g,"-")}`?.toLowerCase()),Array.isArray(e?.allowedTypes)&&!e.allowedTypes?.includes(g)&&r(`Invalid file type: "${g}". Allowed types: ${e.allowedTypes.join(", ")}`);const C=h.indexOf(`\r
\r
`)+4,v=Buffer.from(h.substring(C),"binary"),E=v.buffer.slice(v.byteOffset,v.byteOffset+v.byteLength);typeof e?.maxSize<"u"&&v.byteLength>e.maxSize&&r(`File size exceeds the limit: ${v.byteLength} bytes (Max: ${e.maxSize} bytes)`);const T=new File([E],m,{type:g});o[y]?Array.isArray(o[y])?o[y].push(T):o[y]=[o[y],T]:o[y]=T}}n(o)}catch{}})});if(s==="deno"||s==="bun"){const n=await l.formData(),r={};for(const[i,o]of n.entries()){let a=o;if(a instanceof File&&typeof e=="object"){let c=a.name;if(e?.sanitized&&(c=`${Date.now()}-${c.replace(/\s+/g,"")?.replace(/[^a-zA-Z0-9.-]/g,"-")}`?.toLowerCase()),Array.isArray(e?.allowedTypes)&&!e.allowedTypes?.includes(a.type))throw new Error(`Invalid file type: "${a.type}". Allowed types: ${e.allowedTypes.join(", ")}`);if(typeof e?.maxSize<"u"&&a.size>e.maxSize)throw new Error(`File size exceeds the limit: ${a.size} bytes (Max: ${e.maxSize} bytes)`);a=new File([await a.arrayBuffer()],c,{type:a.type})}r[i]?Array.isArray(r[i])?r[i].push(a):r[i]=[r[i],a]:r[i]=a}return r}else throw new Error("Unsupported environment for multipart parsing")}d(H,"parseMultipartBody");function z(l){const t=/^(?:(\w+):\/\/)?(?:([^:@]+)?(?::([^@]+))?@)?([^:/?#]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/;let e=l.match(t);const[s,n,r,i,o,a,c,h,u]=e;let f=o;n&&(f=n+"://"+o),a&&(f=f+":"+a);let p=c;p?.endsWith("/")&&p.slice(0,-1);function m(){return h?(decodeURIComponent(h).split("&")?.map(v=>{const[E,T]=v.split("=");return{[E]:T}})).reduce(function(v,E){return{...v,...E}},{}):{}}return d(m,"query"),{pathname:p,hash:u,protocol:n,origin:f,username:r,password:i,hostname:o,href:l,port:a,query:m()}}d(z,"urlParse");class I{static{d(this,"Request")}headers=new j;url;method;urlRef={hash:void 0,protocol:void 0,origin:void 0,username:void 0,password:void 0,hostname:void 0,port:void 0,href:void 0,query:{},pathname:"/"};query;#e;params={};constructor(t,e){if(this.headers=new j(t?.headers),this.method=t?.method?.toUpperCase(),this.params=e,this.#e=t,x.getEnvironment=="node"){const s=x.detectProtocol(t),n=x.getHost(this.headers);this.url=`${s}://${n}${t.url}`}else this.url=t.url;this.urlRef=z(this.url),this.query=this.urlRef.query}async text(){return await k(this.#e)}async json(){return(this.headers.get("content-type")||"").includes("application/json")?await O(this.#e):{}}async formData(t){const e=this.headers.get("content-type")||"";if(!e)throw Error("Invalid Content-Type");if(e.includes("application/json"))return await O(this.#e);if(e.includes("application/x-www-form-urlencoded"))return L(this.#e);if(e.includes("multipart/form-data")){const s=e?.split("; ")?.[1]?.split("=")?.[1];if(!s)throw Error("Boundary not found");return await H(this.#e,s,t)}else return{}}}class B{static{d(this,"JetResponse")}static json(t,...e){let s=200,n={"Content-Type":"application/json; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(JSON.stringify(t),{status:s,headers:n})}static html(t,...e){let s=200,n={"Content-Type":"text/html; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(t,{status:s,headers:n})}static text(t,...e){let s=200,n={"Content-Type":"text/plain; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(t,{status:s,headers:n})}static xml(t,...e){let s=200,n={"Content-Type":"application/xml; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(t,{status:s,headers:n})}static send(t,...e){let s=200,n={};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n=e[1])):typeof e[0]=="object"&&(n=e[0]),n["Content-Type"]||(typeof t=="string"?n["Content-Type"]="text/plain;":typeof t=="object"&&t!==null?(n["Content-Type"]="application/json;",t=JSON.stringify(t)):n["Content-Type"]="application/octet-stream"),new Response(t,{status:s,headers:n})}static redirect(t,e=302,s){return new Response(null,{status:e,headers:{Location:t}})}static async download(t,e){try{let s=!1;const n=x.getEnvironment;if(n==="node"){const{existsSync:i}=await import("fs");s=i(t)}else if(n==="bun")s=Bun.file(t).exists();else if(n==="deno")try{await Deno.stat(t),s=!0}catch{s=!1}if(!s)throw Error("File not found");let r;if(n==="node"){const{readFileSync:i}=await import("fs");r=await i(t)}else n==="bun"?r=await Bun.file(t).arrayBuffer().then(i=>new Uint8Array(i)):n==="deno"&&(r=await Deno.readFile(t));return new Response(r,{status:200,headers:{"Content-Disposition":`attachment; filename="${e}"`,"Content-Type":"application/octet-stream","Content-Length":r.byteLength.toString()}})}catch(s){throw Error("Internal Server Error"+s?.message)}}static async sendFile(t,...e){try{const s=x.getEnvironment,n=t;let r=!1;if(s==="node"){const{existsSync:p}=await import("fs");r=p(n)}else if(s==="bun")r=Bun.file(n).exists();else if(s==="deno")try{await Deno.stat(n),r=!0}catch{r=!1}if(!r)throw Error("File not found");let i=0;if(s==="node"){const{statSync:p}=await import("fs");i=p(n).size}else s==="bun"?i=(await Bun.file(n).arrayBuffer()).byteLength:s==="deno"&&(i=(await Deno.stat(n)).size);const o={html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",ico:"image/x-icon",pdf:"application/pdf",txt:"text/plain",xml:"application/xml",mp4:"video/mp4",webm:"video/webm",ogg:"audio/ogg",mp3:"audio/mpeg",wav:"audio/wav",zip:"application/zip",gz:"application/gzip",tar:"application/x-tar"},a=t.split(".").pop()?.toLowerCase()||"",c=o[a]||"application/octet-stream";let h;if(s==="node"){const{createReadStream:p}=await import("fs");h=p(n)}else s==="bun"?h=Bun.file(n).stream():s==="deno"&&(h=(await Deno.open(n,{read:!0})).readable);let u={"Content-Type":c,"Content-Length":i.toString()},f="";return typeof e[0]=="string"?(f=e[0],typeof e[1]=="object"&&(u={...u,...e[1]})):typeof e[0]=="object"&&(u={...u,...e[0]}),f&&(u["Content-Disposition"]=`attachment; filename="${f}"`),new Response(h,{status:200,headers:u})}catch(s){throw Error("Internal Server Error"+s?.message)}}}class q{static{d(this,"State")}state;constructor(){this.state=new Map}set(t,e){this.state.set(t,e)}get(t){return this.state.get(t)}delete(t){return this.state.delete(t)}has(t){return this.state.has(t)}keys(){return Array.from(this.state.keys())}values(){return Array.from(this.state.values())}entries(){return Array.from(this.state.entries())}clear(){this.state.clear()}}const M={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};class U{static{d(this,"Context")}#e;env={};headers=new j;res=new Response;pathname;url;method;#t=200;state=new q;#n={};#r;finalized=!1;#s;#o;#i;#a;#l=!0;#c;#d;#f;#u;#h;constructor(t){this.#e=t,this.method=t?.method?.toUpperCase(),this.pathname=this.req.urlRef.pathname,this.url=this.req.url}get cookies(){const t=this.headers.getAll("cookie");let e={};if(Array.isArray(t)&&t.length!=0){const s=t.join("; ").split(";");for(const n of s){const[r,i]=n?.trim()?.split("=");e[r]=decodeURIComponent(i)}}else if(typeof t=="string"){const s=t.split(";");for(const n of s){const[r,i]=n?.trim()?.split("=");e[r]=decodeURIComponent(i)}}return{get:d(s=>e?.[s],"get"),all:d(()=>e,"all"),delete:d((s,n)=>{const r="",i={...n,expires:new Date(0)},o=`${s}=${r};${F(i)}`;this.headers.set("Set-Cookie",o)},"delete"),set:d((s,n,r)=>{const i=`${s}=${n};${F(r||{})}`;this.headers.set("Set-Cookie",i)},"set")}}json(t,...e){let s=this.#t,n={"Content-Type":"application/json; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(JSON.stringify(t),{status:s,headers:n})}send(t,...e){let s=this.#t,n={};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n=e[1])):typeof e[0]=="object"&&(n=e[0]),n["Content-Type"]||(typeof t=="string"?n["Content-Type"]="text/plain;":typeof t=="object"&&t!==null?(n["Content-Type"]="application/json;",t=JSON.stringify(t)):n["Content-Type"]="application/octet-stream"),new Response(t,{status:s,headers:n})}html(t,...e){let s=this.#t,n={"Content-Type":"text/html; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(t,{status:s,headers:n})}text(t,...e){let s=this.#t,n={"Content-Type":"text/plain; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(t,{status:s,headers:n})}xml(t,...e){let s=this.#t,n={"Content-Type":"application/xml; charset=utf-8"};return typeof e[0]=="number"?(s=e[0],typeof e[1]=="object"&&(n={...n,...e[1]})):typeof e[0]=="object"&&(n={...n,...e[0]}),new Response(t,{status:s,headers:n})}status=d(t=>(this.#t=t,this),"status");redirect(t,e=302,s){return B.redirect(t,e,s)}async download(t,e){return await B.download(t,e)}async sendFile(t,...e){return await B.sendFile(t,...e)}get req(){return new I(this.#e,this.params)}set params(t){this.#n=t}get params(){return this.#n}}function F(l){const t=[];return l.maxAge&&t.push(`Max-Age=${l.maxAge}`),l.expires&&t.push(`Expires=${l.expires.toUTCString()}`),l.path&&t.push(`Path=${l.path}`),l.domain&&t.push(`Domain=${l.domain}`),l.secure&&t.push("Secure"),l.httpOnly&&t.push("HttpOnly"),l.sameSite&&t.push(`SameSite=${l.sameSite}`),t.join("; ")}d(F,"serializeOptions");let b=class{static{d(this,"GlobalConfig")}static middlewareRule="ignore";static env;static notFound=d(l=>{const{method:t,urlRef:{pathname:e}}=l.req;return new Response(`${t}: '${e}' could not find
`,{headers:{"Content-Type":"text/plain"},status:404})},"notFound");static onError=d((l,t)=>{throw Error(l)},"onError");static loggerFn=d(()=>({}),"loggerFn")};function W(l){async function t(s,n){console.log(n.addr);const r=await l.serve(s);return r instanceof Response?r:new Response(r.body,{status:r.status,statusText:r.statusText||M[r?.status],headers:new Headers(r.headers)})}d(t,"handleRequest");function e(s,n){const r=typeof Deno<"u";try{const i=r?Deno.serve({port:s},t):null;if(!i)throw new Error("Deno is not find");const a=`\x1B[1m\u{1F680} Deno Accelero Server running at \x1B[1;34mhttp\x1B[0m://localhost:${s}/\x1B[0m`;if(typeof n=="function")n(a);else{const c=b.loggerFn();c.success&&c.success(a)}return i}catch(i){throw new Error(i?.message)}}return d(e,"listen"),{listen:e}}d(W,"denoAdapter");function J(l){function t(e,s){const n=typeof Bun<"u"?Bun.serve:null;try{if(!n)throw new Error("Bun is not find");const r=n({port:e,async fetch(a){console.log(r.requestIP(a));const c=await l.serve(a);return c instanceof Response?c:new Response(c.body,{status:c.status,statusText:c.statusText||M[c?.status],headers:new Headers(c.headers)})}}),o=`\x1B[1m Bun \u{1F680}Accelero Server running at \x1B[1;34mhttp\x1B[0m://localhost:${e}/\x1B[0m`;if(typeof s=="function")s(o);else{const a=b.loggerFn();a.success&&a.success(o)}return r}catch(r){throw new Error(r?.message)}}return d(t,"listen"),{listen:t}}d(J,"bunAdapter");function V(l){function t(e,s){import("http").then(n=>{let r=n.createServer(async(i,o)=>{const a=await l.serve(i);console.log(i.socket.remoteAddress);const c=a?.statusText;if(!(a instanceof Response))throw new Error("Invalid response from Accelero.serve");const h=Object.fromEntries(await a.headers.entries());c&&(o.statusMessage=c),o.writeHead(a.status,h);const{Readable:u}=await import("stream");if(a.body instanceof u)a.body.pipe(o);else{const f=await a.arrayBuffer();o.end(Buffer.from(f))}});r.listen(e,()=>{const o=`\x1B[1m NodeJS \u{1F680}Accelero Server running at \x1B[1;34mhttp\x1B[0m://localhost:${e}/\x1B[0m`;if(typeof s=="function")s(o);else{const a=b.loggerFn();a.success&&a.success(o)}return r})}).catch(n=>{throw Error(n.message)})}return d(t,"listen"),{listen:t}}d(V,"nodeAdapter");class G{static{d(this,"CommonHandler")}notFound(t){return b.notFound=t,this}onError(t){return b.onError=t,this}}class R{static{d(this,"TriMiddleware")}children=new Map;middlewares=[];groupMiddlewares=new Map;isOptional=!1;pathname;constructor(t="/"){this.pathname=t}}class _ extends G{static{d(this,"MiddlewareConfigure")}triMiddlewares=new R;basePath;constructor(t="/"){super(),this.basePath=t}addMiddleware(t,e){const s=`${this.basePath}/${t}`?.split("/").filter(Boolean);let n=this.triMiddlewares;for(const r of s)if(r.startsWith("*"))n.children.has("*")||n.children.set("*",new R),n=n.children.get("*");else if(r.startsWith(":")){const i=r?.endsWith("?");if(i){n.isOptional=i;continue}n.children.has(":")||n.children.set(":",new R),n=n.children.get(":")}else n.children.has(r)||n.children.set(r,new R),n=n.children.get(r);n.middlewares.push(...e)}}class A{static{d(this,"TrieRouter")}children=new Map;handlers=new Map;pathname;paramName;isParam=!1;constructor(t="/"){this.children=new Map,this.pathname=t}}class $ extends _{static{d(this,"Router")}routers=new Map;rootNode;constructor({basePath:t="/",env:e={}}={}){super(t),this.basePath=t,b.env={...b.env,...e},this.rootNode=new A(t),this.get.bind(this),this.post.bind(this),this.put.bind(this),this.delete.bind(this),this.all.bind(this),this.#s.bind(this),this.addRouter.bind(this),this.group.bind(this)}get(t,...e){return this.#e("GET",t,...e),this}post(t,...e){return this.#e("POST",t,...e),this}put(t,...e){return this.#e("PUT",t,...e),this}patch(t,...e){return this.#e("PATCH",t,...e),this}delete(t,...e){return this.#e("DELETE",t,...e),this}options(t,...e){return this.#e("OPTIONS",t,...e),this}head(t,...e){return this.#e("HEAD",t,...e),this}all(t,...e){return this.#e("ALL",t,...e),this}addRoute(t,e,...s){return this.#e(t,e,...s),this}addRouter(t,e){return this.#s(t,e)}group(t,e){const s=new $({basePath:t,env:b.env});return e(s),this.#s("/",s),this}use(...t){let e="/",s=[],n;return typeof t[0]=="string"?(e=t[0],Array.isArray(t[1])?(s=t[1],n=t[2]):typeof t[1]=="function"?(s=[t[1]],n=t[2]):n=t[1]):typeof t[0]=="function"?t.length===1?s=[t[0]]:(s=[t[0]],n=t[1]):Array.isArray(t[0])?(s=t[0],n=t[1]):t[0]instanceof $&&(n=t[0]),this.#n(e,s),n&&n instanceof $&&this.addRouter(e,n),this}#e(t,e,...s){if(s.length===0)throw new Error("At least one handler is required.");let n=[],r;if(s.length>1?(Array.isArray(s[0])?n=s[0]:typeof s[0]=="function"&&(n=[s[0]]),r=s[s.length-1]):r=s[0],typeof r!="function")throw new Error("Route callback function is missing or invalid.");if(!n.every(i=>typeof i=="function"))throw new Error("Middleware must be a function or an array of functions.");this.#t(t,e,r,n)}#t(t,e,s,n){const r=`${this.basePath}/${e}`.replace(/\\/g,"")?.split("/").filter(Boolean);let i=r.join("/");if(/(\/\*|\?)/.test(i)){let a=this.routers.get(i);return a?a.set(t,{callback:s,middlewares:n}):(a=new Map,a.set(t,{callback:s,middlewares:n}),this.routers.set(i,a))}let o=this.rootNode;for(const a of r)a.startsWith(":")?(o.children.has(":")||o.children.set(":",new A),o=o.children.get(":"),o.isParam=!0,o.paramName||(o.paramName=a.slice(1))):(o.children.has(a)||o.children.set(a,new A),o=o.children.get(a));o.handlers.set(t,{callback:s,middlewares:n}),o.pathname=e}#n(t,e){this.addMiddleware(t,e)}#r(){return`HNDLR-${Date.now().toString(16)}-${Math.random().toString(16).slice(2)}`}#s(t,e){const s=`${this.basePath}/${t}`.replace(/\\/g,"")?.split("/").filter(Boolean);let n;if(b.middlewareRule=="ignore"&&(n=this.#r()),e.routers.size)for(const[o,a]of e.routers){let c=o;if(s.length!==0&&(c=s?.join("/")+"/"+o),this.routers.has(c)){const h=this.routers.get(c);for(const[u,f]of a)f.handlerID=n,h.set(u,f);continue}if(n)for(const[h,u]of a)u.handlerID=n;this.routers.set(c,a)}let r=this.rootNode,i=this.triMiddlewares;if(s.length==0)this.#o(r,i,e,n);else{for(const o of s)o.startsWith(":")?(r.children.has(":")||r.children.set(":",new A),r=r.children.get(":"),r.isParam=!0,r.paramName||(r.paramName=o.slice(1))):(r.children.has(o)||r.children.set(o,new A),r=r.children.get(o));for(const o of s)if(o.startsWith("*"))i.children.has("*")||i.children.set("*",new R),i=i.children.get("*");else if(o.startsWith(":")){const a=o?.endsWith("?");if(a){i.isOptional=a;continue}i.children.has(":")||i.children.set(":",new R),i=i.children.get(":")}else i.children.has(o)||i.children.set(o,new R),i=i.children.get(o);this.#o(r,i,e,n)}}#o(t,e,s,n){function r(c,h){let u=h;for(const f of c)if(u.children.has(f[0])){let p=u.children.get(f[0]);for(const[m,y]of f[1].handlers){let g={...y,handlerID:n};p.handlers.set(m,g)}f[1].children.size&&r(f[1].children,p)}else{if(n){let p=d(function(m){for(const[y,g]of m.handlers)g.handlerID=n;for(const[y,g]of m.children)p(g)},"assignHandlerIDs2");p(f[1])}u.children.set(f[0],f[1])}}d(r,"addSubRouter");function i(c,h){let u=h;for(const[f,p]of c)if(u.children.has(f)){let m=u.children.get(f);if(n){let y=[...p.middlewares];m.groupMiddlewares.set(n,y)}else m.middlewares.push(...p.middlewares);p.children.size&&i(p.children,m)}else{if(n){let m=d(function(y){let g=[...y.middlewares];y.groupMiddlewares.set(n,g);for(const[,C]of y.children)m(C)},"assignHandlerIDs2");m(p)}u.children.set(f,p)}}d(i,"addMiddleware");let o=s.rootNode;const a=s.triMiddlewares;for(const[c,h]of o.handlers){let u={...h,handlerID:n};t.handlers.set(c,u)}o.children.size>0&&r(o.children,t),n?e.groupMiddlewares.set(n,[...a.middlewares]):e.middlewares.push(...a.middlewares),a.children.size>0&&i(a.children,e)}}function Z({path:l,urlPattern:t}){let e={};l=l.replace(/^\/+|\/+$/g,""),t=t.replace(/^\/+|\/+$/g,"");const s=l?l.split("/"):[],n=t?t.split("/"):[],r=s.length,i=n.length;if(r>i&&!t.includes("*"))return{success:!1,params:{}};let o=0;for(let a=0;a<i;a++){const c=n[a];if(c?.startsWith("*")){const u=n.slice(a+1);let f=c.length==1?"*":c?.slice(1);if(u.length>0){const p=u.join("/"),m=s.slice(r-u.length).join("/"),y=s.slice(o,r-u.length).join("/");return p!==m||!y?{success:!1,params:{}}:(e[f]=y,{success:!0,params:e})}else{const p=s.slice(o).join("/");return p?(e[f]=p,{success:!0,params:e}):{success:!1,params:{}}}}if(c.startsWith(":")&&c.endsWith("?")){const u=c.slice(1,-1),f=n[a+1];if(f&&!f.startsWith(":")&&f!=="*"&&o<r&&s[o]===f){e[u]=null;continue}const m=n.slice(a+1).filter(g=>!(g.startsWith(":")&&g.endsWith("?"))).length;r-o===m?e[u]=null:o<r?(e[u]=s[o],o++):e[u]=null;continue}if(c.startsWith(":")){const u=c.slice(1);if(!/^[a-zA-Z0-9_]+$/.test(u))return{success:!1,params:{}};if(o<r)e[u]=s[o],o++;else return{success:!1,params:{}};continue}const h=s[o];if(c!==h)return{success:!1,params:{}};o++}return o<r?{success:!1,params:{}}:{success:!0,params:e}}d(Z,"useParams");class K extends ${static{d(this,"Accelero")}constructor({basePath:t="/",middlewareRule:e="follow",env:s={},logger:n=void 0}={}){super({basePath:t,env:s}),b.middlewareRule=e,n&&(b.loggerFn=n),this.serve=this.serve.bind(this)}#e(t,e){const s=this.routers;for(let n of this.routers.keys()){const{success:r,params:i}=Z({path:e,urlPattern:n}),o=s.get(n)?.get(t)||s.get(n)?.get("ALL");if(r&&o)return{handlerID:o.handlerID,callback:o.callback,middlewares:o.middlewares,params:i}}return null}#t(t,e){const s=e.split("/").filter(Boolean),n={};let r=this.rootNode;for(let i of s)if(r.children.has(i))r=r.children.get(i);else if(r.children.has(":"))r=r.children.get(":"),r.paramName&&(n[r.paramName]=i);else return null;if(r?.handlers?.size&&r?.pathname){const i=r.handlers.get(t)||r.handlers.get("ALL");return i?{handlerID:i?.handlerID,middlewares:i.middlewares,callback:i.callback,params:n}:null}return null}findRoute(t,e){return this.#t(t,e)||this.#e(t,e)}#n(t,e){return async s=>{let n=0;const r=d(async()=>n<t.length?t[n++](s,r):await e(s),"next");return await r()}}#r(t,e){const s=t.split("/").filter(Boolean);let n=[],r=this.triMiddlewares;for(let i of s){if(r.children.has(i))r=r.children.get(i);else if(r.children.has("*"))r=r.children.get("*");else if(r.children.has(":"))r=r.children.get(":");else break;e?n.push(...r.groupMiddlewares.get(e)||[]):n.push(...r.middlewares)}return n}async#s(t){let e=new U(t);const s=e.req.urlRef,{pathname:n}=s;let r=this.#r(n);e.env=b.env;const i=b.loggerFn();i.request&&i.request(e.method,e.pathname);try{return await this.#n([...this.triMiddlewares.middlewares,...r],async o=>{const a=this.findRoute(o.req.method,n);if(a?.callback){o.params=a.params;const c=a.callback,h=a.handlerID;let u=[...a.middlewares];h&&u.push(...this.#r(n,h));const f=await this.#n(u,c)(o);f?.headers&&o.headers.add(f.headers);const p=f?.statusText||M[f?.status]||"",m=f.status||200;let y=o.headers.toObject();return i.response&&i.response(o.method,o.pathname,m),f instanceof Response?new Response(f.body,{status:m,statusText:p,headers:y}):new Response(f.body,{status:m,statusText:p,headers:y})}else return i.response&&i.response(o.method,o.pathname,404),b.notFound(o)})(e)}catch(o){let a=o;return o instanceof Error&&(a=o.message),i.error&&i.error(`${M[500]}: ${a} `),b.onError(a,e)}}async serve(t){return this.#s(t)}}function Q(l,t){try{let e=!1,s=x.getEnvironment;if(s==="node"||s==="bun"){const{existsSync:i}=N("fs");e=i(l)}else if(s==="deno")try{Deno.statSync(l),e=!0}catch{e=!1}if(!e)return;let n="";if(s==="node"||s==="bun"){const{readFileSync:i}=N("fs");n=i(l,"utf8")}else s==="deno"&&(n=new TextDecoder("utf-8").decode(Deno.readFileSync(l)));const r=n.split(`
`);for(const i of r){const o=i.trim();if(!o||o.startsWith("#"))continue;const[a,c]=o.split("=",2).map(h=>h.trim());if(a&&c){const h=c.replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1");t[a]=h,s==="node"||s==="bun"?process.env[a]=h:s==="deno"&&Deno.env.set(a,h)}}}catch(e){console.error(`[dotenv] Error parsing file: ${l}`,e)}}d(Q,"parseEnvFile");function X(l="./"){const t={},e=[".env",".env.local",`.env.${process?.env?.NODE_ENV||"development"}`,`.env.${process?.env?.NODE_ENV||"development"}.local`];for(const s of e)Q(`${l}${s}`,t);return t}d(X,"loadEnv");const w={reset:"\x1B[0m",bold:"\x1B[1m",gray:"\x1B[90m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m"},S=d((l,t,...e)=>{const s=new Date().toISOString(),n={info:w.blue,warn:w.yellow,error:w.red,debug:w.cyan,success:w.green},r=`${w.gray}[${s}]${w.reset}`,i=`${n[l]}[${l.toUpperCase()}]${w.reset}`;console.log(`${r} ${i} ${t}`,...e?.flat())},"loggerOutput");function Y(){const l=performance.now();return{request:d((t,e)=>{console.log(`${w.bold}<-- ${w.reset}${w.bgMagenta} ${t} ${w.reset} ${e}`)},"request"),response:d((t,e,s)=>{const n=performance.now()-l;console.log(`${w.bold}--> ${w.reset}${w.bgBlue} ${t} ${w.reset} ${e} ${w.yellow}${s}${w.reset} ${w.magenta}${n.toFixed(2)}ms${w.reset}`)},"response"),info:d((t,...e)=>S("info",t,...e),"info"),warn:d((t,...e)=>S("warn",t,...e),"warn"),error:d((t,...e)=>S("error",t,...e),"error"),debug:d((t,...e)=>S("debug",t,...e),"debug"),success:d((t,...e)=>S("success",t,...e),"success")}}d(Y,"logger");function ee(l={}){const{methods:t,allowedHeaders:e,credentials:s,exposedHeaders:n,maxAge:r,origin:i}=l;return async(o,a)=>{const c=o.req.headers.get("origin")||"";let h="*";return typeof i=="string"?h=i:i instanceof RegExp?h=i.test(c)?c:"":Array.isArray(i)?h=i.some(f=>{if(typeof f=="string")return f===c;if(f instanceof RegExp)return f.test(c)})?c:"":typeof i=="function"&&(h=i(c)?c:""),o.headers.set("Access-Control-Allow-Origin",h),o.headers.set("Access-Control-Allow-Methods",(t||["GET","POST","PUT","DELETE"]).join(", ")),o.headers.set("Access-Control-Allow-Headers",(e||["Content-Type","Authorization"]).join(", ")),n&&o.headers.set("Access-Control-Expose-Headers",n.join(", ")),s&&o.headers.set("Access-Control-Allow-Credentials","true"),r&&o.headers.set("Access-Control-Max-Age",r.toString()),o.req.method==="OPTIONS"?new Response(null,{status:204,headers:o.headers.toObject()}):await a()}}d(ee,"cors");export{K as Accelero,B as JetResponse,$ as Router,J as bunAdapter,ee as cors,W as denoAdapter,X as loadEnv,Y as logger,V as nodeAdapter};
