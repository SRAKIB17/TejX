"use strict";var P=Object.create;var O=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var d=(l,e)=>O(l,"name",{value:e,configurable:!0});var I=(l,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of L(e))!z.call(l,n)&&n!==t&&O(l,n,{get:()=>e[n],enumerable:!(s=k(e,n))||s.enumerable});return l};var R=(l,e,t)=>(t=l!=null?P(H(l)):{},I(e||!l||!l.__esModule?O(t,"default",{value:l,enumerable:!0}):t,l));class B{static{d(this,"HeadersParser")}headers=new Map;constructor(e){e&&this.add(e)}add(e){if(Array.isArray(e))for(const[t,s]of e)this.set(t,s);else if(typeof Headers<"u"&&e instanceof Headers)for(const[t,s]of e.entries())this.set(t,s);else if(typeof e=="object")for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this.set(t,e[t]);return this}set(e,t){return this.headers.set(e.toLowerCase(),Array.isArray(t)?t:[t]),this}get(e){const t=this.headers.get(e.toLowerCase());return t?t[0]:void 0}getAll(e){return this.headers.get(e.toLowerCase())||[]}has(e){return this.headers.has(e.toLowerCase())}delete(e){return this.headers.delete(e.toLowerCase())}append(e,t){const s=e.toLowerCase();return this.headers.has(s)?this.headers.get(s).push(t):this.headers.set(s,[t]),this}entries(){return this.headers.entries()}keys(){return this.headers.keys()}values(){return this.headers.values()}forEach(e){for(const[t,s]of this.headers)e(s,t)}toObject(){const e={};for(const[t,s]of this.headers.entries())e[t]=s.length>1?s:s[0];return e}}Object.defineProperty(B,"name",{value:"Headers"});class x{static{d(this,"EnvironmentDetector")}static get getEnvironment(){return typeof Bun<"u"?"bun":typeof Deno<"u"?"deno":typeof process<"u"&&process.versions?.node?"node":"unknown"}static detectProtocol(e){try{return this.getEnvironment==="node"?e?.socket?.encrypted?"https":"http":"unknown"}catch{throw new Error("Failed to detect protocol.")}}static getHost(e){try{return e?.get("host")||"unknown"}catch{throw new Error("Failed to get host.")}}}async function F(l){const e=x.getEnvironment;if(e==="node")return new Promise((t,s)=>{let n="";l.on("data",r=>{n+=r.toString()}),l.on("end",()=>{try{t(JSON.parse(n))}catch{s(new Error("Invalid JSON format"))}})});if(e==="deno"||e==="bun")return await l.json();throw new Error("Unsupported environment for multipart parsing")}d(F,"parseJsonBody");async function q(l){const e=x.getEnvironment;if(e==="node")return new Promise((t,s)=>{let n="";l.on("data",r=>{n+=r.toString()}),l.on("end",()=>{try{t(n)}catch{s(new Error("Invalid JSON format"))}})});if(e==="deno"||e==="bun")return await l.text();throw new Error("Unsupported environment for multipart parsing")}d(q,"parseTextBody");async function U(l){const e=x.getEnvironment;if(e==="node")return new Promise((t,s)=>{let n="";l.on("data",r=>{n+=r.toString("binary")}),l.on("end",()=>{try{const r=n.split("&"),i={};r.forEach(o=>{const[a,c]=o.split("=");i[decodeURIComponent(a)]=decodeURIComponent(c||"")}),t(i)}catch{s(new Error("Invalid x-www-form-urlencoded format"))}})});if(e==="deno"||e==="bun"){const t=await l.formData(),s={};for(const[n,r]of t.entries())s[n]=r;return s}else throw new Error("Unsupported environment for multipart parsing")}d(U,"parseUrlEncodedBody");async function W(l,e,t){const s=x.getEnvironment;if(t?.sanitized,s==="node")return new Promise((n,r)=>{let i="";l.on("data",o=>{i+=o.toString("binary")}),l.on("end",()=>{try{const o={};i.split("----------------------------").forEach(h=>{const u=h.match(/name="(.*)"\r\n\r\n(.*)\r\n/);if(u&&u.length===3){const f=u[1],p=u[2];o[f]=p}});const c=i.split(`--${e}`);for(const h of c)if(h.includes("filename")){const u=h.match(/filename="([^"]+)"/),f=h.match(/name="([^"]+)"/),p=h.match(/Content-Type: ([^\r\n]+)/);if(u&&f&&p){let m=u[1];const y=f[1],g=p[1];t?.sanitized&&(m=`${Date.now()}-${m.replace(/\s+/g,"")?.replace(/[^a-zA-Z0-9.-]/g,"-")}`?.toLowerCase()),Array.isArray(t?.allowedTypes)&&!t.allowedTypes?.includes(g)&&r(`Invalid file type: "${g}". Allowed types: ${t.allowedTypes.join(", ")}`);const j=h.indexOf(`\r
\r
`)+4,v=Buffer.from(h.substring(j),"binary"),A=v.buffer.slice(v.byteOffset,v.byteOffset+v.byteLength);typeof t?.maxSize<"u"&&v.byteLength>t.maxSize&&r(`File size exceeds the limit: ${v.byteLength} bytes (Max: ${t.maxSize} bytes)`);const T=new File([A],m,{type:g});o[y]?Array.isArray(o[y])?o[y].push(T):o[y]=[o[y],T]:o[y]=T}}n(o)}catch{}})});if(s==="deno"||s==="bun"){const n=await l.formData(),r={};for(const[i,o]of n.entries()){let a=o;if(a instanceof File&&typeof t=="object"){let c=a.name;if(t?.sanitized&&(c=`${Date.now()}-${c.replace(/\s+/g,"")?.replace(/[^a-zA-Z0-9.-]/g,"-")}`?.toLowerCase()),Array.isArray(t?.allowedTypes)&&!t.allowedTypes?.includes(a.type))throw new Error(`Invalid file type: "${a.type}". Allowed types: ${t.allowedTypes.join(", ")}`);if(typeof t?.maxSize<"u"&&a.size>t.maxSize)throw new Error(`File size exceeds the limit: ${a.size} bytes (Max: ${t.maxSize} bytes)`);a=new File([await a.arrayBuffer()],c,{type:a.type})}r[i]?Array.isArray(r[i])?r[i].push(a):r[i]=[r[i],a]:r[i]=a}return r}else throw new Error("Unsupported environment for multipart parsing")}d(W,"parseMultipartBody");function J(l){const e=/^(?:(\w+):\/\/)?(?:([^:@]+)?(?::([^@]+))?@)?([^:/?#]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/;let t=l.match(e);const[s,n,r,i,o,a,c,h,u]=t;let f=o;n&&(f=n+"://"+o),a&&(f=f+":"+a);let p=c;p?.endsWith("/")&&p.slice(0,-1);function m(){return h?(decodeURIComponent(h).split("&")?.map(v=>{const[A,T]=v.split("=");return{[A]:T}})).reduce(function(v,A){return{...v,...A}},{}):{}}return d(m,"query"),{pathname:p,hash:u,protocol:n,origin:f,username:r,password:i,hostname:o,href:l,port:a,query:m()}}d(J,"urlParse");class V{static{d(this,"Request")}headers=new B;url;method;urlRef={hash:void 0,protocol:void 0,origin:void 0,username:void 0,password:void 0,hostname:void 0,port:void 0,href:void 0,query:{},pathname:"/"};query;#e;params={};constructor(e,t){if(this.headers=new B(e?.headers),this.method=e?.method?.toUpperCase(),this.params=t,this.#e=e,x.getEnvironment=="node"){const s=x.detectProtocol(e),n=x.getHost(this.headers);this.url=`${s}://${n}${e.url}`}else this.url=e.url;this.urlRef=J(this.url),this.query=this.urlRef.query}async text(){return await q(this.#e)}async json(){return(this.headers.get("content-type")||"").includes("application/json")?await F(this.#e):{}}async formData(e){const t=this.headers.get("content-type")||"";if(!t)throw Error("Invalid Content-Type");if(t.includes("application/json"))return await F(this.#e);if(t.includes("application/x-www-form-urlencoded"))return U(this.#e);if(t.includes("multipart/form-data")){const s=t?.split("; ")?.[1]?.split("=")?.[1];if(!s)throw Error("Boundary not found");return await W(this.#e,s,e)}else return{}}}class M{static{d(this,"JetResponse")}static json(e,...t){let s=200,n={"Content-Type":"application/json; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(JSON.stringify(e),{status:s,headers:n})}static html(e,...t){let s=200,n={"Content-Type":"text/html; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(e,{status:s,headers:n})}static text(e,...t){let s=200,n={"Content-Type":"text/plain; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(e,{status:s,headers:n})}static xml(e,...t){let s=200,n={"Content-Type":"application/xml; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(e,{status:s,headers:n})}static send(e,...t){let s=200,n={};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n=t[1])):typeof t[0]=="object"&&(n=t[0]),n["Content-Type"]||(typeof e=="string"?n["Content-Type"]="text/plain;":typeof e=="object"&&e!==null?(n["Content-Type"]="application/json;",e=JSON.stringify(e)):n["Content-Type"]="application/octet-stream"),new Response(e,{status:s,headers:n})}static redirect(e,t=302,s){return new Response(null,{status:t,headers:{Location:e}})}static async download(e,t){try{let s=!1;const n=x.getEnvironment;if(n==="node"){const{existsSync:i}=await import("fs");s=i(e)}else if(n==="bun")s=Bun.file(e).exists();else if(n==="deno")try{await Deno.stat(e),s=!0}catch{s=!1}if(!s)throw Error("File not found");let r;if(n==="node"){const{readFileSync:i}=await import("fs");r=await i(e)}else n==="bun"?r=await Bun.file(e).arrayBuffer().then(i=>new Uint8Array(i)):n==="deno"&&(r=await Deno.readFile(e));return new Response(r,{status:200,headers:{"Content-Disposition":`attachment; filename="${t}"`,"Content-Type":"application/octet-stream","Content-Length":r.byteLength.toString()}})}catch(s){throw Error("Internal Server Error"+s?.message)}}static async sendFile(e,...t){try{const s=x.getEnvironment,n=e;let r=!1;if(s==="node"){const{existsSync:p}=await import("fs");r=p(n)}else if(s==="bun")r=Bun.file(n).exists();else if(s==="deno")try{await Deno.stat(n),r=!0}catch{r=!1}if(!r)throw Error("File not found");let i=0;if(s==="node"){const{statSync:p}=await import("fs");i=p(n).size}else s==="bun"?i=(await Bun.file(n).arrayBuffer()).byteLength:s==="deno"&&(i=(await Deno.stat(n)).size);const o={html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",ico:"image/x-icon",pdf:"application/pdf",txt:"text/plain",xml:"application/xml",mp4:"video/mp4",webm:"video/webm",ogg:"audio/ogg",mp3:"audio/mpeg",wav:"audio/wav",zip:"application/zip",gz:"application/gzip",tar:"application/x-tar"},a=e.split(".").pop()?.toLowerCase()||"",c=o[a]||"application/octet-stream";let h;if(s==="node"){const{createReadStream:p}=await import("fs");h=p(n)}else s==="bun"?h=Bun.file(n).stream():s==="deno"&&(h=(await Deno.open(n,{read:!0})).readable);let u={"Content-Type":c,"Content-Length":i.toString()},f="";return typeof t[0]=="string"?(f=t[0],typeof t[1]=="object"&&(u={...u,...t[1]})):typeof t[0]=="object"&&(u={...u,...t[0]}),f&&(u["Content-Disposition"]=`attachment; filename="${f}"`),new Response(h,{status:200,headers:u})}catch(s){throw Error("Internal Server Error"+s?.message)}}}class G{static{d(this,"State")}state;constructor(){this.state=new Map}set(e,t){this.state.set(e,t)}get(e){return this.state.get(e)}delete(e){return this.state.delete(e)}has(e){return this.state.has(e)}keys(){return Array.from(this.state.keys())}values(){return Array.from(this.state.values())}entries(){return Array.from(this.state.entries())}clear(){this.state.clear()}}const N={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};class Z{static{d(this,"Context")}#e;env={};headers=new B;res=new Response;pathname;url;method;#t=200;state=new G;#n={};#r;finalized=!1;#s;#o;#i;#a;#l=!0;#c;#d;#f;#u;#h;constructor(e){this.#e=e,this.method=e?.method?.toUpperCase(),this.pathname=this.req.urlRef.pathname,this.url=this.req.url}get cookies(){const e=this.headers.getAll("cookie");let t={};if(Array.isArray(e)&&e.length!=0){const s=e.join("; ").split(";");for(const n of s){const[r,i]=n?.trim()?.split("=");t[r]=decodeURIComponent(i)}}else if(typeof e=="string"){const s=e.split(";");for(const n of s){const[r,i]=n?.trim()?.split("=");t[r]=decodeURIComponent(i)}}return{get:d(s=>t?.[s],"get"),all:d(()=>t,"all"),delete:d((s,n)=>{const r="",i={...n,expires:new Date(0)},o=`${s}=${r};${D(i)}`;this.headers.set("Set-Cookie",o)},"delete"),set:d((s,n,r)=>{const i=`${s}=${n};${D(r||{})}`;this.headers.set("Set-Cookie",i)},"set")}}json(e,...t){let s=this.#t,n={"Content-Type":"application/json; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(JSON.stringify(e),{status:s,headers:n})}send(e,...t){let s=this.#t,n={};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n=t[1])):typeof t[0]=="object"&&(n=t[0]),n["Content-Type"]||(typeof e=="string"?n["Content-Type"]="text/plain;":typeof e=="object"&&e!==null?(n["Content-Type"]="application/json;",e=JSON.stringify(e)):n["Content-Type"]="application/octet-stream"),new Response(e,{status:s,headers:n})}html(e,...t){let s=this.#t,n={"Content-Type":"text/html; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(e,{status:s,headers:n})}text(e,...t){let s=this.#t,n={"Content-Type":"text/plain; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(e,{status:s,headers:n})}xml(e,...t){let s=this.#t,n={"Content-Type":"application/xml; charset=utf-8"};return typeof t[0]=="number"?(s=t[0],typeof t[1]=="object"&&(n={...n,...t[1]})):typeof t[0]=="object"&&(n={...n,...t[0]}),new Response(e,{status:s,headers:n})}status=d(e=>(this.#t=e,this),"status");redirect(e,t=302,s){return M.redirect(e,t,s)}async download(e,t){return await M.download(e,t)}async sendFile(e,...t){return await M.sendFile(e,...t)}get req(){return new V(this.#e,this.params)}set params(e){this.#n=e}get params(){return this.#n}}function D(l){const e=[];return l.maxAge&&e.push(`Max-Age=${l.maxAge}`),l.expires&&e.push(`Expires=${l.expires.toUTCString()}`),l.path&&e.push(`Path=${l.path}`),l.domain&&e.push(`Domain=${l.domain}`),l.secure&&e.push("Secure"),l.httpOnly&&e.push("HttpOnly"),l.sameSite&&e.push(`SameSite=${l.sameSite}`),e.join("; ")}d(D,"serializeOptions");let b=class{static{d(this,"GlobalConfig")}static middlewareRule="ignore";static env;static notFound=d(l=>{const{method:e,urlRef:{pathname:t}}=l.req;return new Response(`${e}: '${t}' could not find
`,{headers:{"Content-Type":"text/plain"},status:404})},"notFound");static onError=d((l,e)=>{throw Error(l)},"onError");static loggerFn=d(()=>({}),"loggerFn")};function _(l){async function e(s,n){console.log(n.addr);const r=await l.serve(s);return r instanceof Response?r:new Response(r.body,{status:r.status,statusText:r.statusText||N[r?.status],headers:new Headers(r.headers)})}d(e,"handleRequest");function t(s,n){const r=typeof Deno<"u";try{const i=r?Deno.serve({port:s},e):null;if(!i)throw new Error("Deno is not find");const a=`\x1B[1m\u{1F680} Deno Accelero Server running at \x1B[1;34mhttp\x1B[0m://localhost:${s}/\x1B[0m`;if(typeof n=="function")n(a);else{const c=b.loggerFn();c.success&&c.success(a)}return i}catch(i){throw new Error(i?.message)}}return d(t,"listen"),{listen:t}}d(_,"denoAdapter");function K(l){function e(t,s){const n=typeof Bun<"u"?Bun.serve:null;try{if(!n)throw new Error("Bun is not find");const r=n({port:t,async fetch(a){console.log(r.requestIP(a));const c=await l.serve(a);return c instanceof Response?c:new Response(c.body,{status:c.status,statusText:c.statusText||N[c?.status],headers:new Headers(c.headers)})}}),o=`\x1B[1m Bun \u{1F680}Accelero Server running at \x1B[1;34mhttp\x1B[0m://localhost:${t}/\x1B[0m`;if(typeof s=="function")s(o);else{const a=b.loggerFn();a.success&&a.success(o)}return r}catch(r){throw new Error(r?.message)}}return d(e,"listen"),{listen:e}}d(K,"bunAdapter");function Q(l){function e(t,s){import("http").then(n=>{let r=n.createServer(async(i,o)=>{const a=await l.serve(i);console.log(i.socket.remoteAddress);const c=a?.statusText;if(!(a instanceof Response))throw new Error("Invalid response from Accelero.serve");const h=Object.fromEntries(await a.headers.entries());c&&(o.statusMessage=c),o.writeHead(a.status,h);const{Readable:u}=await import("stream");if(a.body instanceof u)a.body.pipe(o);else{const f=await a.arrayBuffer();o.end(Buffer.from(f))}});r.listen(t,()=>{const o=`\x1B[1m NodeJS \u{1F680}Accelero Server running at \x1B[1;34mhttp\x1B[0m://localhost:${t}/\x1B[0m`;if(typeof s=="function")s(o);else{const a=b.loggerFn();a.success&&a.success(o)}return r})}).catch(n=>{throw Error(n.message)})}return d(e,"listen"),{listen:e}}d(Q,"nodeAdapter");class X{static{d(this,"CommonHandler")}notFound(e){return b.notFound=e,this}onError(e){return b.onError=e,this}}class ${static{d(this,"TriMiddleware")}children=new Map;middlewares=[];groupMiddlewares=new Map;isOptional=!1;pathname;constructor(e="/"){this.pathname=e}}class Y extends X{static{d(this,"MiddlewareConfigure")}triMiddlewares=new $;basePath;constructor(e="/"){super(),this.basePath=e}addMiddleware(e,t){const s=`${this.basePath}/${e}`?.split("/").filter(Boolean);let n=this.triMiddlewares;for(const r of s)if(r.startsWith("*"))n.children.has("*")||n.children.set("*",new $),n=n.children.get("*");else if(r.startsWith(":")){const i=r?.endsWith("?");if(i){n.isOptional=i;continue}n.children.has(":")||n.children.set(":",new $),n=n.children.get(":")}else n.children.has(r)||n.children.set(r,new $),n=n.children.get(r);n.middlewares.push(...t)}}class S{static{d(this,"TrieRouter")}children=new Map;handlers=new Map;pathname;paramName;isParam=!1;constructor(e="/"){this.children=new Map,this.pathname=e}}class E extends Y{static{d(this,"Router")}routers=new Map;rootNode;constructor({basePath:e="/",env:t={}}={}){super(e),this.basePath=e,b.env={...b.env,...t},this.rootNode=new S(e),this.get.bind(this),this.post.bind(this),this.put.bind(this),this.delete.bind(this),this.all.bind(this),this.#s.bind(this),this.addRouter.bind(this),this.group.bind(this)}get(e,...t){return this.#e("GET",e,...t),this}post(e,...t){return this.#e("POST",e,...t),this}put(e,...t){return this.#e("PUT",e,...t),this}patch(e,...t){return this.#e("PATCH",e,...t),this}delete(e,...t){return this.#e("DELETE",e,...t),this}options(e,...t){return this.#e("OPTIONS",e,...t),this}head(e,...t){return this.#e("HEAD",e,...t),this}all(e,...t){return this.#e("ALL",e,...t),this}addRoute(e,t,...s){return this.#e(e,t,...s),this}addRouter(e,t){return this.#s(e,t)}group(e,t){const s=new E({basePath:e,env:b.env});return t(s),this.#s("/",s),this}use(...e){let t="/",s=[],n;return typeof e[0]=="string"?(t=e[0],Array.isArray(e[1])?(s=e[1],n=e[2]):typeof e[1]=="function"?(s=[e[1]],n=e[2]):n=e[1]):typeof e[0]=="function"?e.length===1?s=[e[0]]:(s=[e[0]],n=e[1]):Array.isArray(e[0])?(s=e[0],n=e[1]):e[0]instanceof E&&(n=e[0]),this.#n(t,s),n&&n instanceof E&&this.addRouter(t,n),this}#e(e,t,...s){if(s.length===0)throw new Error("At least one handler is required.");let n=[],r;if(s.length>1?(Array.isArray(s[0])?n=s[0]:typeof s[0]=="function"&&(n=[s[0]]),r=s[s.length-1]):r=s[0],typeof r!="function")throw new Error("Route callback function is missing or invalid.");if(!n.every(i=>typeof i=="function"))throw new Error("Middleware must be a function or an array of functions.");this.#t(e,t,r,n)}#t(e,t,s,n){const r=`${this.basePath}/${t}`.replace(/\\/g,"")?.split("/").filter(Boolean);let i=r.join("/");if(/(\/\*|\?)/.test(i)){let a=this.routers.get(i);return a?a.set(e,{callback:s,middlewares:n}):(a=new Map,a.set(e,{callback:s,middlewares:n}),this.routers.set(i,a))}let o=this.rootNode;for(const a of r)a.startsWith(":")?(o.children.has(":")||o.children.set(":",new S),o=o.children.get(":"),o.isParam=!0,o.paramName||(o.paramName=a.slice(1))):(o.children.has(a)||o.children.set(a,new S),o=o.children.get(a));o.handlers.set(e,{callback:s,middlewares:n}),o.pathname=t}#n(e,t){this.addMiddleware(e,t)}#r(){return`HNDLR-${Date.now().toString(16)}-${Math.random().toString(16).slice(2)}`}#s(e,t){const s=`${this.basePath}/${e}`.replace(/\\/g,"")?.split("/").filter(Boolean);let n;if(b.middlewareRule=="ignore"&&(n=this.#r()),t.routers.size)for(const[o,a]of t.routers){let c=o;if(s.length!==0&&(c=s?.join("/")+"/"+o),this.routers.has(c)){const h=this.routers.get(c);for(const[u,f]of a)f.handlerID=n,h.set(u,f);continue}if(n)for(const[h,u]of a)u.handlerID=n;this.routers.set(c,a)}let r=this.rootNode,i=this.triMiddlewares;if(s.length==0)this.#o(r,i,t,n);else{for(const o of s)o.startsWith(":")?(r.children.has(":")||r.children.set(":",new S),r=r.children.get(":"),r.isParam=!0,r.paramName||(r.paramName=o.slice(1))):(r.children.has(o)||r.children.set(o,new S),r=r.children.get(o));for(const o of s)if(o.startsWith("*"))i.children.has("*")||i.children.set("*",new $),i=i.children.get("*");else if(o.startsWith(":")){const a=o?.endsWith("?");if(a){i.isOptional=a;continue}i.children.has(":")||i.children.set(":",new $),i=i.children.get(":")}else i.children.has(o)||i.children.set(o,new $),i=i.children.get(o);this.#o(r,i,t,n)}}#o(e,t,s,n){function r(c,h){let u=h;for(const f of c)if(u.children.has(f[0])){let p=u.children.get(f[0]);for(const[m,y]of f[1].handlers){let g={...y,handlerID:n};p.handlers.set(m,g)}f[1].children.size&&r(f[1].children,p)}else{if(n){let p=d(function(m){for(const[y,g]of m.handlers)g.handlerID=n;for(const[y,g]of m.children)p(g)},"assignHandlerIDs2");p(f[1])}u.children.set(f[0],f[1])}}d(r,"addSubRouter");function i(c,h){let u=h;for(const[f,p]of c)if(u.children.has(f)){let m=u.children.get(f);if(n){let y=[...p.middlewares];m.groupMiddlewares.set(n,y)}else m.middlewares.push(...p.middlewares);p.children.size&&i(p.children,m)}else{if(n){let m=d(function(y){let g=[...y.middlewares];y.groupMiddlewares.set(n,g);for(const[,j]of y.children)m(j)},"assignHandlerIDs2");m(p)}u.children.set(f,p)}}d(i,"addMiddleware");let o=s.rootNode;const a=s.triMiddlewares;for(const[c,h]of o.handlers){let u={...h,handlerID:n};e.handlers.set(c,u)}o.children.size>0&&r(o.children,e),n?t.groupMiddlewares.set(n,[...a.middlewares]):t.middlewares.push(...a.middlewares),a.children.size>0&&i(a.children,t)}}function ee({path:l,urlPattern:e}){let t={};l=l.replace(/^\/+|\/+$/g,""),e=e.replace(/^\/+|\/+$/g,"");const s=l?l.split("/"):[],n=e?e.split("/"):[],r=s.length,i=n.length;if(r>i&&!e.includes("*"))return{success:!1,params:{}};let o=0;for(let a=0;a<i;a++){const c=n[a];if(c?.startsWith("*")){const u=n.slice(a+1);let f=c.length==1?"*":c?.slice(1);if(u.length>0){const p=u.join("/"),m=s.slice(r-u.length).join("/"),y=s.slice(o,r-u.length).join("/");return p!==m||!y?{success:!1,params:{}}:(t[f]=y,{success:!0,params:t})}else{const p=s.slice(o).join("/");return p?(t[f]=p,{success:!0,params:t}):{success:!1,params:{}}}}if(c.startsWith(":")&&c.endsWith("?")){const u=c.slice(1,-1),f=n[a+1];if(f&&!f.startsWith(":")&&f!=="*"&&o<r&&s[o]===f){t[u]=null;continue}const m=n.slice(a+1).filter(g=>!(g.startsWith(":")&&g.endsWith("?"))).length;r-o===m?t[u]=null:o<r?(t[u]=s[o],o++):t[u]=null;continue}if(c.startsWith(":")){const u=c.slice(1);if(!/^[a-zA-Z0-9_]+$/.test(u))return{success:!1,params:{}};if(o<r)t[u]=s[o],o++;else return{success:!1,params:{}};continue}const h=s[o];if(c!==h)return{success:!1,params:{}};o++}return o<r?{success:!1,params:{}}:{success:!0,params:t}}d(ee,"useParams");class te extends E{static{d(this,"Accelero")}constructor({basePath:e="/",middlewareRule:t="follow",env:s={},logger:n=void 0}={}){super({basePath:e,env:s}),b.middlewareRule=t,n&&(b.loggerFn=n),this.serve=this.serve.bind(this)}#e(e,t){const s=this.routers;for(let n of this.routers.keys()){const{success:r,params:i}=ee({path:t,urlPattern:n}),o=s.get(n)?.get(e)||s.get(n)?.get("ALL");if(r&&o)return{handlerID:o.handlerID,callback:o.callback,middlewares:o.middlewares,params:i}}return null}#t(e,t){const s=t.split("/").filter(Boolean),n={};let r=this.rootNode;for(let i of s)if(r.children.has(i))r=r.children.get(i);else if(r.children.has(":"))r=r.children.get(":"),r.paramName&&(n[r.paramName]=i);else return null;if(r?.handlers?.size&&r?.pathname){const i=r.handlers.get(e)||r.handlers.get("ALL");return i?{handlerID:i?.handlerID,middlewares:i.middlewares,callback:i.callback,params:n}:null}return null}findRoute(e,t){return this.#t(e,t)||this.#e(e,t)}#n(e,t){return async s=>{let n=0;const r=d(async()=>n<e.length?e[n++](s,r):await t(s),"next");return await r()}}#r(e,t){const s=e.split("/").filter(Boolean);let n=[],r=this.triMiddlewares;for(let i of s){if(r.children.has(i))r=r.children.get(i);else if(r.children.has("*"))r=r.children.get("*");else if(r.children.has(":"))r=r.children.get(":");else break;t?n.push(...r.groupMiddlewares.get(t)||[]):n.push(...r.middlewares)}return n}async#s(e){let t=new Z(e);const s=t.req.urlRef,{pathname:n}=s;let r=this.#r(n);t.env=b.env;const i=b.loggerFn();i.request&&i.request(t.method,t.pathname);try{return await this.#n([...this.triMiddlewares.middlewares,...r],async o=>{const a=this.findRoute(o.req.method,n);if(a?.callback){o.params=a.params;const c=a.callback,h=a.handlerID;let u=[...a.middlewares];h&&u.push(...this.#r(n,h));const f=await this.#n(u,c)(o);f?.headers&&o.headers.add(f.headers);const p=f?.statusText||N[f?.status]||"",m=f.status||200;let y=o.headers.toObject();return i.response&&i.response(o.method,o.pathname,m),f instanceof Response?new Response(f.body,{status:m,statusText:p,headers:y}):new Response(f.body,{status:m,statusText:p,headers:y})}else return i.response&&i.response(o.method,o.pathname,404),b.notFound(o)})(t)}catch(o){let a=o;return o instanceof Error&&(a=o.message),i.error&&i.error(`${N[500]}: ${a} `),b.onError(a,t)}}async serve(e){return this.#s(e)}}function ne(l,e){try{let t=!1,s=x.getEnvironment;if(s==="node"||s==="bun"){const{existsSync:i}=require("fs");t=i(l)}else if(s==="deno")try{Deno.statSync(l),t=!0}catch{t=!1}if(!t)return;let n="";if(s==="node"||s==="bun"){const{readFileSync:i}=require("fs");n=i(l,"utf8")}else s==="deno"&&(n=new TextDecoder("utf-8").decode(Deno.readFileSync(l)));const r=n.split(`
`);for(const i of r){const o=i.trim();if(!o||o.startsWith("#"))continue;const[a,c]=o.split("=",2).map(h=>h.trim());if(a&&c){const h=c.replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1");e[a]=h,s==="node"||s==="bun"?process.env[a]=h:s==="deno"&&Deno.env.set(a,h)}}}catch(t){console.error(`[dotenv] Error parsing file: ${l}`,t)}}d(ne,"parseEnvFile");function se(l="./"){const e={},t=[".env",".env.local",`.env.${process?.env?.NODE_ENV||"development"}`,`.env.${process?.env?.NODE_ENV||"development"}.local`];for(const s of t)ne(`${l}${s}`,e);return e}d(se,"loadEnv");const w={reset:"\x1B[0m",bold:"\x1B[1m",gray:"\x1B[90m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m"},C=d((l,e,...t)=>{const s=new Date().toISOString(),n={info:w.blue,warn:w.yellow,error:w.red,debug:w.cyan,success:w.green},r=`${w.gray}[${s}]${w.reset}`,i=`${n[l]}[${l.toUpperCase()}]${w.reset}`;console.log(`${r} ${i} ${e}`,...t?.flat())},"loggerOutput");function re(){const l=performance.now();return{request:d((e,t)=>{console.log(`${w.bold}<-- ${w.reset}${w.bgMagenta} ${e} ${w.reset} ${t}`)},"request"),response:d((e,t,s)=>{const n=performance.now()-l;console.log(`${w.bold}--> ${w.reset}${w.bgBlue} ${e} ${w.reset} ${t} ${w.yellow}${s}${w.reset} ${w.magenta}${n.toFixed(2)}ms${w.reset}`)},"response"),info:d((e,...t)=>C("info",e,...t),"info"),warn:d((e,...t)=>C("warn",e,...t),"warn"),error:d((e,...t)=>C("error",e,...t),"error"),debug:d((e,...t)=>C("debug",e,...t),"debug"),success:d((e,...t)=>C("success",e,...t),"success")}}d(re,"logger");function oe(l={}){const{methods:e,allowedHeaders:t,credentials:s,exposedHeaders:n,maxAge:r,origin:i}=l;return async(o,a)=>{const c=o.req.headers.get("origin")||"";let h="*";return typeof i=="string"?h=i:i instanceof RegExp?h=i.test(c)?c:"":Array.isArray(i)?h=i.some(f=>{if(typeof f=="string")return f===c;if(f instanceof RegExp)return f.test(c)})?c:"":typeof i=="function"&&(h=i(c)?c:""),o.headers.set("Access-Control-Allow-Origin",h),o.headers.set("Access-Control-Allow-Methods",(e||["GET","POST","PUT","DELETE"]).join(", ")),o.headers.set("Access-Control-Allow-Headers",(t||["Content-Type","Authorization"]).join(", ")),n&&o.headers.set("Access-Control-Expose-Headers",n.join(", ")),s&&o.headers.set("Access-Control-Allow-Credentials","true"),r&&o.headers.set("Access-Control-Max-Age",r.toString()),o.req.method==="OPTIONS"?new Response(null,{status:204,headers:o.headers.toObject()}):await a()}}d(oe,"cors"),exports.Accelero=te,exports.JetResponse=M,exports.Router=E,exports.bunAdapter=K,exports.cors=oe,exports.denoAdapter=_,exports.loadEnv=se,exports.logger=re,exports.nodeAdapter=Q;
